{% extends 'core/base.html' %}

{% block title %}{{ item.name }}{% endblock %}

{% block content %}
<!-- Category navigation bar -->
<div class="w-full sticky top-0 z-200 bg-gray-300 border-b border-gray-300 mb-8">
    <div class="container mx-auto px-6 py-4 overflow-x-auto whitespace-nowrap flex gap-10">
        {% for category in categories %}
        <a href="{% url 'item:category' category.id %}"
           class="text-gray-700 hover:text-black text-lg font-bold shrink-0 transition-all duration-200">
            {{ category.name }}
        </a>
        {% endfor %}
    </div>
</div>

<div class="flex gap-6 bg-gray-300 p-10 rounded-xl text-gray-900">
    <!-- Image Section -->
    <div class="w-1/2 flex justify-center items-center">
        <img src="{{ item.image.url }}"
             alt="{{ item.name }}"
             class="w-full h-[450px] object-contain rounded-xl bg-white p-4 shadow" />
    </div>

    <!-- Info Section -->
    <div class="w-1/2 bg-white p-8 rounded-xl shadow">
        <h1 class="text-3xl font-bold mb-4 text-gray-900">{{ item.name }}</h1>
        <p class="text-gray-700 mb-2"><strong>Price:</strong> {{ item.price }} UZS</p>
        <p class="text-gray-700 mb-2"><strong>Seller:</strong> {{ item.created_by.username }}</p>

        {% if item.description %}
        <p class="text-gray-700 mb-4"><strong>Description:</strong> {{ item.description }}</p>
        {% endif %}

        {% if request.user == item.created_by %}
        <div class="mt-4 bg-gray-100 p-4 rounded-xl">
            <p class="mb-2 text-green-600 font-semibold">This is your item!</p>
            <a href="{% url 'item:edit' item.id %}"
               class="inline-block bg-teal-500 text-white px-4 py-2 rounded hover:bg-teal-600 mr-2">Edit</a>
            <a href="{% url 'item:delete' item.id %}"
               class="inline-block bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Delete</a>
        </div>
        {% else %}
        <a href="{% url 'conversation:new' item.id %}"
           class="inline-block bg-teal-500 text-white px-6 py-3 mt-6 rounded-xl hover:bg-teal-600">Contact seller</a>
        {% endif %}
    </div>
</div>

<!-- Comment section -->
<div class="mt-12 w-1/2 pr-6 overflow-y-auto max-h-[500px]">
    <h2 class="text-xl font-bold mb-4 text-gray-800">Comments</h2>

    {% if request.user.is_authenticated %}
    <form method="post" class="mb-6">
        {% csrf_token %}
        {{ form }}
        <button class="mt-2 px-4 py-2 bg-teal-600 text-white rounded">Post</button>
    </form>
    {% else %}
    <p class="text-gray-500">Please <a href="{% url 'core:login' %}" class="text-blue-500 hover:underline">log in</a> to comment.</p>
    {% endif %}

    {% for comment in comments %}
    <div class="mt-6 p-4 bg-white rounded shadow">
        <p class="font-semibold text-gray-800">{{ comment.user.username }}</p>
        <p class="text-gray-700">{{ comment.content }}</p>
        <small class="text-gray-500">{{ comment.created_at }}</small>

        {% if request.user == comment.user %}
        <div class="flex gap-3 mt-2">
            <!-- Delete button -->
            <form method="post" action="{% url 'item:delete_comment' comment.id %}">
                {% csrf_token %}
                <button class="text-red-600 text-sm hover:underline">Delete</button>
            </form>

            <!-- Edit button -->
            <a href="{% url 'item:edit_comment' comment.id %}" class="text-blue-600 text-sm hover:underline">Edit</a>
        </div>
        {% endif %}
    </div>
    {% endfor %}

    <div class="mt-6">
        {% if comments.has_previous %}
        <a href="?page={{ comments.previous_page_number }}" class="px-3 py-1 bg-gray-200 rounded text-gray-800">Previous</a>
        {% endif %}
        {% if comments.has_next %}
        <a href="?page={{ comments.next_page_number }}" class="px-3 py-1 bg-gray-200 rounded text-gray-800">Next</a>
        {% endif %}
    </div>
</div>

<!-- Related Items -->
{% if related_items %}
<div class="mt-12 px-6 py-12 bg-gray-100 rounded-xl text-gray-900">
    <h2 class="mb-8 text-2xl text-center">Related Items</h2>

    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
        {% for related in related_items %}
        <div>
            <a href="{% url 'item:detail' related.id %}">
                <div>
                    <img src="{{ related.image.url }}"
                         class="rounded-t-xl w-full h-64 object-contain bg-white p-2"
                         alt="{{ related.name }}">
                </div>

                <div class="p-6 bg-white rounded-b-xl">
                    <h2 class="text-2xl text-gray-800">{{ related.name }}</h2>
                    <p class="text-gray-600">{{ related.price }} UZS</p>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endblock %}
